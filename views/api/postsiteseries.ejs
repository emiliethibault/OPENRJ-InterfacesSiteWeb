<div id="wrapper">

    <!-- PAGE TITLE -->
    <header id="page-title">
        <div class="container">
            <h1><%= title.replace('OpeNRJ - API - ', '') %></h1>

            <ul class="breadcrumb">
                <li><a href="/">Accueil</a></li>
                <li><a href="/api">Documentation - API</a></li>
                <li class="active"><%= title.replace('OpeNRJ - API - ', '') %></li>
            </ul>
        </div>
    </header>

    <section class="container">
    <h1>Créer des séries temporelles pour les variables d'un site</h1>

    <h2>Présentation</h2>
        <table class="table table-bordered table-striped">
            <colgroup>
                <col width="40%" />
                <col width="20%" />
                <col width="10%" />
                <col width="30%" />
            </colgroup>
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Autorisation</th>
                    <th>Méthode</th>
                    <th>Requête</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Cette requête permet de créer des séries temporelles de données pour une ou plusieurs variables d'un site. Pour simplifier et limiter l'impact d'un tel envoi sur la bande passante, nous avons choisi d'écrire les séries temporelles de données à l'intérieur de plusieurs fichier TSV et d'envoyer tous ces fichiers dans une archive ZIP. Cette requête ne permet que d'envoyer une archive ZIP sur le serveur. Le stockage des données se fait de façon asynchrone. Après la bonne réception de l'archive, un job de traitement des données est lancé. C'est lui qui indiquera si les données ont bien était enregistrées dans la base de données ou non. Pou connaître l'état du job, il faudra lancer la requête décrite dans la section <a class="reference external" href="/api/get-job">Récupérer l'état du job de traitement des séries temporelles</a>.</td>
                    <td>Requise par Basic HTTP (nom d'utilisateur et mot de passe)</td>
                    <td>POST</td>
                    <td>/v1/users/:userID/sites/:siteID/variables/series</td>
                </tr>
            </tbody>
        </table>

        <div>
            <h3>Paramètre de l'URL</h2>
            <table class="table table-bordered table-striped">
                <colgroup>
                    <col width="25%" />
                    <col width="25%" />
                    <col width="50%" />
                </colgroup>
                <thead>
                    <tr>
                        <th>Paramètre</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>:userID</td>
                        <td>String</td>
                        <td>Identifiant unique de l'utilisateur. Si vous ne connaissez pas votre identifiant, vous pouvez utiliser le mot clé &quot;current&quot; à la place.</td>
                    </tr>
                    <tr>
                        <td>:siteID</td>
                        <td>String</td>
                        <td>Identifiant unique du site.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div>
            <h3>Paramètre de la requête</h2>
            <h4>Requis</h4>
            
            <table class="table table-bordered table-striped">
                <colgroup>
                    <col width="25%" />
                    <col width="25%" />
                    <col width="50%" />
                </colgroup>
                <thead>
                    <tr>
                        <th>Paramètre</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>zip</td>
                        <td>File</td>
                        <td>Archive au format ZIP contenant tous les fichiers TSV contenant les séries temporelles de données. Un fichier correspond aux données d'une variable. Le format des fichiers TSV est décrit ci-dessous.</td>
                    </tr>
                </tbody>
            </table>

            <h5>Format</h5>
            <p>
                Chaque série temporelle doit être stockée dans un fichier TSV différent où chaque entité doit être séparée par des tabulations. Il y aura donc un fichier TSV par Variable. Ces fichiers seront ensuite réunis dans une archive ZIP afin d'être compressés. L'archive ZIP portera le nom SITE_ID-series.zip où SITE_ID est l'identifiant du site. Chaque fichier TSV à l'intérieur de l'archive portera le nom VARIABLE_ID.YYMMDDHHmmss.csv où VARIABLE_ID est l'identifiant de la variable, et YYMMDDHHmmss est la date de création du fichier au format YYMMDDHHmmss. Par exemple, si nous créons le fichier le 20 mai 2014 à 18:33:24 pour la variable plug_3, le nom du fichier sera plug_3.140520183324.csv. Si nous continuons notre exemple et que notre site s'appelle TEST_PARIS, nous générerons une archive ZIP qui aura comme nom TEST_PARIS-series.zip et contiendra un seul fichier qui s'appellera plug_3.140520183324.csv.
            </p>
            <p>
                Voici le format d'une série temporelle d'une variable (remplacez VARIABLE_ID par l'identifiant de votre variable, SITE_ID par l'identifiant de votre site et les &quot;timestamps&quot; et les &quot;values&quot; par vos données) :
            </p>
            <pre>
            FORMAT_VERSION  1
            CREATION_DATE   2014-05-15T16:04:34Z
            ID_SITE SITE_ID
            FEEDBACK_TO me&#64;worldcompany.com
            VARNAME VARIABLE_ID

            2013-10-24T00:00:00Z    11894
            2013-10-24T06:00:00Z    11894
            2013-10-24T12:00:00Z    11894
            2013-10-24T18:00:00Z    11895
            </pre>

            <table class="table table-bordered table-striped">
                <colgroup>
                    <col width="25%" />
                    <col width="75%" />
                </colgroup>
                <tbody>
                    <tr>
                        <th>FORMAT_VERSION</th>
                        <td>Version du format de fichier utilisé. Actuellement, nous utilisons la version 1.</td>
                    </tr>
                    <tr>
                        <th>CREATION_DATE</th>
                        <td>Date de création du fichier.</td>
                    </tr>
                    <tr>
                        <th>ID_SITE</th>
                        <td>Identifiant de votre site,</td>
                    </tr>
                    <tr>
                        <th>FEEDBACK_TO</th>
                        <td>Adresse e-mail de la personne en charge du site qui sera prévenu de la création des données,</td>
                    </tr>
                    <tr>
                        <th>VARNAME</th>
                        <td>Identifiant unique de la variable,</td>
                    </tr>
                    <tr>
                        <th>timestamp</th>
                        <td>Chaque ligne suivant doit contenir une date UTC valide au format ISO8601</td>
                    </tr>
                    <tr>
                        <th>value</th>
                        <td>Chaque ligne suivant doit contenir une valeur cohérente par rapport à la définition des méta-données de la variable.</td>
                    </tr>
                </tbody>
            </table>

            <h4>Optionnel</h4>
            <p>Aucun.</p>
        </div>

        <div>
            <h2>Message de succès</h2>
            <h3>Exemple de requête</h3>
            
            <pre>
            curl -i -X POST 'https://api.openrj.eu/v1/users/current/sites/test_site/variables/series' -u cstb_test:cstb2014 -F zip=@test_site-series.zip

            201 CREATED

            {
                "message": "Data transfered with success.",
                "jobID": "53"
            }
            </pre>
            <h3>Détails</h3>
            <table class="table table-bordered table-striped">
                <colgroup>
                    <col width="25%" />
                    <col width="25%" />
                    <col width="50%" />
                </colgroup>
                <thead>
                    <tr>
                        <th>Paramètre</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>jobID</td>
                        <td>String</td>
                        <td>Numéro du job crée côté serveur. Ce numéro de job doit être utilisé dans la requête de récupération du job pour voir si les séries temporelles contenues dans l'archive ZIP sont bien enregistrées ou non.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div>
            <h2>Message d'erreur &quot;Missing ZIP archive&quot;</h2>
            <h3>Exemple de requête</h3>
            
            <pre>
            curl -i -X POST 'https://api.openrj.eu/v1/users/current/sites/test_site/variables/series' -u cstb_test:cstb2014

            400 BAD REQUEST

            {
                "error": "Missing ZIP archive."
            }
            </pre>
            <h3>Causes</h3>
            <p>Vous avez oublié de joindre l'archive ZIP à la requête REST. Vérifiez bien que vous l'envoyez en tant que fichier joint à la requête et pas en tant que &quot;query string&quot; ou dans le &quot;body&quot; de la requête.</p>
        </div>

        <div>
            <h2>Message d'erreur &quot;Corrupted ZIP archive&quot;</h2>
            <h3>Exemple de requête</h3>
            
            <pre>
            curl -i -X POST 'https://api.openrj.eu/v1/users/current/sites/test_site/variables/series' -u cstb_test:cstb2014 -F zip=@invalid_test_site-series.zip

            400 BAD REQUEST

            {
                "error": "Corrupted ZIP archive."
            }
            </pre>
            <h3>Causes</h3>
            <p>L'archive que vous avez envoyé est illisible. Veuillez la recompresser et l'envoyer de nouveau.</p>
        </div>

        <div>
            <h2>Message d'erreur &quot;ZIP already exist&quot;</h2>
            <h3>Exemple de requête</h3>
            
            <pre>
            curl -i -X POST 'https://api.openrj.eu/v1/users/current/sites/test_site/variables/series' -u cstb_test:cstb2014 -F zip=@test_site-series.zip

            400 BAD REQUEST

            {
                "error": "ZIP already exist"
            }
            </pre>
            <h3>Causes</h3>
            <p>L'archive que vous avez envoyé est déjà présente sur le serveur. Veuillez la renommer et l'envoyer de nouveau.</p>
        </div>

        <div>
            <h2>Message d'erreur &quot;Missing authorization headers&quot;</h2>
            <h3>Exemple de requête</h3>
            
            <pre>
            curl -i -X POST 'https://api.openrj.eu/v1/users/current/sites/test_site/variables/series'

            400 BAD REQUEST

            {
                "error": "Missing authorization headers"
            }
            </pre>
            <h3>Causes</h3>
            <p>Vous avez oublié les paramètres &quot;username&quot; et &quot;password&quot; nécessaire à l'authentification dans votre requête.</p>
        </div>

        <div>
            <h2>Message d'erreur &quot;Unauthorized&quot;</h2>
            <h3>Exemple de requête</h3>
            
            <pre>
            curl -i -X POST 'https://api.openrj.eu/v1/users/current/sites/test_site/variables/series' -u cstb_test:cstb20123

            401 Unauthorized

            {
                "error": "Unauthorized"
            }
            </pre>
            <h3>Causes</h3>
            <p>Vous vous êtes trompé d'identifiant ou vous n'avez pas accès à cette information.</p>
        </div>

        <div>
            <h2>Message d'erreur &quot;Site not found&quot;</h2>
            <h3>Exemple de requête</h3>
            
            <pre>
            curl -i -X POST 'https://api.openrj.eu/v1/users/current/sites/test_sit/variables/series' -u ertyui:ertyu

            404 Not Found

            {
                "error":"Site not found."
            }
            </pre>
            <h3>Causes</h3>
            <p>Ce site n'existe pas.</p>
        </div>
    </section>
</div>

<script type="text/javascript" src="/plugins/jquery-2.0.3.min.js"></script>